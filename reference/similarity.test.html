<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute the similarity test. — similarity.test • spqdep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute the similarity test. — similarity.test"><meta name="description" content="This function compute the nonparametric test for spatial independence
using symbolic analysis for categorical/qualitative spatial process."><meta property="og:description" content="This function compute the nonparametric test for spatial independence
using symbolic analysis for categorical/qualitative spatial process."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spqdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/user-guide.html">User Guide</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/f8l5h9/spqdep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compute the similarity test.</h1>
      <small class="dont-index">Source: <a href="https://github.com/f8l5h9/spqdep/blob/main/R/similarity.test.R" class="external-link"><code>R/similarity.test.R</code></a></small>
      <div class="d-none name"><code>similarity.test.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function compute the nonparametric test for spatial independence
using symbolic analysis for categorical/qualitative spatial process.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">similarity.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="cn">NULL</span>, data <span class="op">=</span> <span class="cn">NULL</span>, fx <span class="op">=</span> <span class="cn">NULL</span>, listw <span class="op">=</span> <span class="va">listw</span>,</span>
<span>alternative <span class="op">=</span> <span class="st">"two.sided"</span>, distr <span class="op">=</span> <span class="st">"asymptotic"</span>, nsim <span class="op">=</span> <span class="cn">NULL</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a symbolic description of the factor (optional).</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an (optional) data frame or a sf object containing the variable to testing for.</p></dd>


<dt id="arg-fx">fx<a class="anchor" aria-label="anchor" href="#arg-fx"></a></dt>
<dd><p>a factor (optional).</p></dd>


<dt id="arg-listw">listw<a class="anchor" aria-label="anchor" href="#arg-listw"></a></dt>
<dd><p>a listw object</p></dd>


<dt id="arg-alternative">alternative<a class="anchor" aria-label="anchor" href="#arg-alternative"></a></dt>
<dd><p>a character string specifying the type of cluster, must be one
of "High" (default), "Both" or "Low".</p></dd>


<dt id="arg-distr">distr<a class="anchor" aria-label="anchor" href="#arg-distr"></a></dt>
<dd><p>A string. Distribution of the test "asymptotic" (default) or "bootstrap"</p></dd>


<dt id="arg-nsim">nsim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>Number of permutations.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>List of additional control arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A object of the <em>htest</em></p><table class="table table"><tr><td><code>data.name</code></td><td>a character string giving the names of the data.</td></tr><tr><td><code>statistic</code></td><td>Value of the similarity test</td></tr><tr><td><code>N</code></td><td>total number of observations.</td></tr><tr><td><code>Zmlc</code></td><td>Elements in the Most Likelihood Cluster.</td></tr><tr><td><code>alternative</code></td><td>a character string describing the alternative hypothesis.</td></tr><tr><td><code>p.value</code></td><td>p-value of the similarity test</td></tr><tr><td><code>similiarity.mc</code></td><td>values of the similarity test in each permutation.</td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This testing approach for spatial independence that extends some of the properties
of the join count statistic. The premise of the tests is similar to the join count
statistic in that they use the concept of similarity between neighbouring spatial
entities (Dacey 1968; Cliff and Ord 1973, 1981). However, it differs by taking
into consideration the number of joins belonging locally to each spatial unit,
rather than the total number of joins in the entire spatial system. The approach
proposed here is applicable to spatial and network contiguity structures, and
the number of neighbors belonging to observations need not be constant.<br></p>
<p>We define an equivalence relation \(\sim\) in the set of locations S. An equivalence
relation satisfies the following properties:<br><br>
Reflexive: \(s_i \sim s_i\) for all \(s_i \in S\),<br>
Symmetric: If \(s_i \sim s_j\), then \(s_j \sim s_i\) for all \(s_i,\ s_j \in S\) and<br>
Transitive: If \(s_i \sim s_j\) and \(s_j \sim s_k\), then \(s_i \sim s_k\)
for all \(s_i, \  s_j, \ s_k \in S\)<br><br>
We call the relation \(\sim\) a similarity relation. Then, the null hypothesis that
we are interested in is
$$H_0: \{X_s\}_{s \in S} \ \ is\ \ iid$$
Assume that, under the null hypothesis, \(P(s_i \sim s_{ji}) = p_i\) for all
\(s_{ji} \in N_{s_i}\). <br>
Define<br>
$$I_{ij}=1 \ \ if \ \ s_i \sim s_{ji} \ \ ; 0 \ \ otherwise$$<br>
Then, for a fixed degree d and for all location si with degree d, the variable d<br>
$$\Lambda_{(d,i)}=\sum_{j=1}^d I_{ij}$$
gives the number of nearest neighbours to si that are similar to si.
Therefore, under the null hypothesis, \(H_0\), \(\Lambda(d,i)\) follows a binomial
distribution \(B(d, p_i)\).</p>
    </div>
    <div class="section level2">
    <h2 id="control-arguments">Control arguments<a class="anchor" aria-label="anchor" href="#control-arguments"></a></h2>


<table class="table table"><tr><td><code>seedinit</code></td><td>Numerical value for the seed (only for boot version). Default value seedinit=123</td></tr></table></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Farber, S., Marin, M. R., &amp; Paez, A. (2015).
Testing for spatial independence using similarity relations.
<em>Geographical Analysis</em>. 47(2), 97-120.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="sp.runs.test.html">sp.runs.test</a></code>, <code><a href="dgp.spq.html">dgp.spq</a></code>, <code><a href="Q.test.html">Q.test</a></code>, , <code><a href="scan.test.html">scan.test</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>

<table class="table table"><tr><td>Fernando López</td><td><a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a></td></tr><tr><td>Román Mínguez</td><td><a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a></td></tr><tr><td>Antonio Páez</td><td><a href="mailto:paezha@gmail.com">paezha@gmail.com</a></td></tr><tr><td>Manuel Ruiz</td><td><a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a></td></tr></table></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 1:</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">cx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">listw</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html" class="external-link">knearneigh</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cx</span>,<span class="va">cy</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu"><a href="dgp.spq.html">dgp.spq</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">p</span>, listw <span class="op">=</span> <span class="va">listw</span>, rho <span class="op">=</span> <span class="va">rho</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 2 sub-graphs</span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2mat.html" class="external-link">nb2mat</a></span><span class="op">(</span><span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knn2nb.html" class="external-link">knn2nb</a></span><span class="op">(</span><span class="va">listw</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">*</span><span class="fl">1</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 2 sub-graphs</span>
<span class="r-in"><span><span class="va">similarity</span> <span class="op">&lt;-</span> <span class="fu">similarity.test</span><span class="op">(</span>fx <span class="op">=</span> <span class="va">fx</span>, data <span class="op">=</span> <span class="va">FastFood.sf</span>, listw <span class="op">=</span> <span class="va">listw</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 2 sub-graphs</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">similarity</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Similarity test of spatial dependence for qualitative data.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Distribution: asymptotic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  fx</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Similarity-test = 1.8171, p-value = 0.06921</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: two.sided</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 2: test with formula, a sf object (points) and knn</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"FastFood.sf"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coor</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">FastFood.sf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">listw</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html" class="external-link">knearneigh</a></span><span class="op">(</span><span class="va">coor</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Type</span></span></span>
<span class="r-in"><span><span class="va">similarity</span> <span class="op">&lt;-</span> <span class="fu">similarity.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">FastFood.sf</span>, listw <span class="op">=</span> <span class="va">listw</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 11 sub-graphs</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">similarity</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Similarity test of spatial dependence for qualitative data.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Distribution: asymptotic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  Type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Similarity-test = -5.4476, p-value = 5.105e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: two.sided</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 3:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">listw</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">poly2nb</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">provinces_spain</span>,<span class="st">"Spatial"</span><span class="op">)</span>, queen <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> although coordinates are longitude/latitude, st_intersects assumes that they</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> are planar</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>some observations have no neighbours;</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> if this seems unexpected, try increasing the snap argument.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 4 sub-graphs;</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> if this sub-graph count seems unexpected, try increasing the snap argument.</span>
<span class="r-in"><span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"men"</span>,<span class="st">"woman"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Mal2Fml</span></span></span>
<span class="r-in"><span><span class="va">similarity</span> <span class="op">&lt;-</span> <span class="fu">similarity.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">provinces_spain</span>, listw <span class="op">=</span> <span class="va">listw</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Out-of-range p-value: reconsider test arguments</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">similarity</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Similarity test of spatial dependence for qualitative data.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Distribution: asymptotic</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  Mal2Fml</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Similarity-test = NaN, p-value = NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: two.sided</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fernando Lopez, Roman Minguez, Antonio Paez, Manuel Ruiz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

