<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute the scan test — scan.test • spqdep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute the scan test — scan.test"><meta name="description" content="This function compute the spatial scan test for Bernoulli and
Multinomial categorical spatial process, and detect spatial clusters"><meta property="og:description" content="This function compute the spatial scan test for Bernoulli and
Multinomial categorical spatial process, and detect spatial clusters"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spqdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/user-guide.html">User Guide</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/f8l5h9/spqdep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compute the scan test</h1>
      <small class="dont-index">Source: <a href="https://github.com/f8l5h9/spqdep/blob/main/R/scan.test.R" class="external-link"><code>R/scan.test.R</code></a></small>
      <div class="d-none name"><code>scan.test.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function compute the spatial scan test for Bernoulli and
Multinomial categorical spatial process, and detect spatial clusters</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">scan.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="cn">NULL</span>, data <span class="op">=</span> <span class="cn">NULL</span>, fx <span class="op">=</span> <span class="cn">NULL</span>, coor <span class="op">=</span> <span class="cn">NULL</span>, case <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>nv <span class="op">=</span> <span class="cn">NULL</span>, nsim <span class="op">=</span> <span class="cn">NULL</span>, distr <span class="op">=</span> <span class="cn">NULL</span>, windows <span class="op">=</span> <span class="st">"circular"</span>, listw <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>alternative <span class="op">=</span> <span class="st">"High"</span>, minsize <span class="op">=</span> <span class="fl">1</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a symbolic description of the factor (optional).</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>an (optional) data frame or a sf object containing the variable to testing for.</p></dd>


<dt id="arg-fx">fx<a class="anchor" aria-label="anchor" href="#arg-fx"></a></dt>
<dd><p>a factor (optional).</p></dd>


<dt id="arg-coor">coor<a class="anchor" aria-label="anchor" href="#arg-coor"></a></dt>
<dd><p>(optional) coordinates of observations.</p></dd>


<dt id="arg-case">case<a class="anchor" aria-label="anchor" href="#arg-case"></a></dt>
<dd><p>Only for Bernoulli distribution. A element of factor, there are cases and non-cases for testing for cases versus non-cases</p></dd>


<dt id="arg-nv">nv<a class="anchor" aria-label="anchor" href="#arg-nv"></a></dt>
<dd><p>Maximum windows size, default nv = N/2. The algorithm scan for clusters of geographic size between 1
and the upper limit (nv) defined by the user.</p></dd>


<dt id="arg-nsim">nsim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>Number of permutations.</p></dd>


<dt id="arg-distr">distr<a class="anchor" aria-label="anchor" href="#arg-distr"></a></dt>
<dd><p>distribution of the spatial process: "bernoulli" for two levels or "multinomial" for three or more levels.</p></dd>


<dt id="arg-windows">windows<a class="anchor" aria-label="anchor" href="#arg-windows"></a></dt>
<dd><p>a string to select the type of cluster "circular" (default) of "elliptic".</p></dd>


<dt id="arg-listw">listw<a class="anchor" aria-label="anchor" href="#arg-listw"></a></dt>
<dd><p>only for flexible windows. A neighbours list (an object of the class listw, nb or knn frop spdep) or an adjacency matrix.</p></dd>


<dt id="arg-alternative">alternative<a class="anchor" aria-label="anchor" href="#arg-alternative"></a></dt>
<dd><p>Only for Bernoulli spatial process. A character string specifying the type of cluster, must be one
of "High" (default), "Both" or "Low".</p></dd>


<dt id="arg-minsize">minsize<a class="anchor" aria-label="anchor" href="#arg-minsize"></a></dt>
<dd><p>Minimum number of observations inside of Most Likely Cluster and secondary clusters.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>List of additional control arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A object of the <em>htest</em> and <em>scantest</em> class</p><table class="table table"><tr><td><code>method</code></td><td>The type of test applied ().</td></tr><tr><td><code>fx</code></td><td>Factor included as input to get the scan test.</td></tr><tr><td><code>MLC</code></td><td>Observations included into the Most Likelihood Cluster (MLC).</td></tr><tr><td><code>statistic</code></td><td>Value of the scan test (maximum Log-likelihood ratio).</td></tr><tr><td><code>N</code></td><td>Total number of observations.</td></tr><tr><td><code>nn</code></td><td>Windows used to get the cluster.</td></tr><tr><td><code>nv</code></td><td>Maximum number of observations into the cluster.</td></tr><tr><td><code>data.name</code></td><td>A character string giving the name of the factor.</td></tr><tr><td><code>coor</code></td><td>coordinates.</td></tr><tr><td><code>alternative</code></td><td>Only for bernoulli spatial process. A character string describing
the alternative hypothesis select by the user.</td></tr><tr><td><code>p.value</code></td><td>p-value of the scan test.</td></tr><tr><td><code>cases.expect</code></td><td>Expected cases into the MLC.</td></tr><tr><td><code>cases.observ</code></td><td>Observed cases into the MLC.</td></tr><tr><td><code>nsim</code></td><td>Number of permutations.</td></tr><tr><td><code>scan.mc</code></td><td>a (nsim x 1) vector with the loglik values under bootstrap permutation.</td></tr><tr><td><code>secondary.clusters</code></td><td>a list with the observations included into the secondary clusters.</td></tr><tr><td><code>loglik.second</code></td><td>a vector with the value of the secondary scan tests (maximum Log-likelihood ratio).</td></tr><tr><td><code>p.value.secondary</code></td><td>a vector with the p-value of the secondary scan tests.</td></tr><tr><td><code>Alternative.MLC</code></td><td>A vector with the observations included in another cluster with the same loglik than MLC.</td></tr></table></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Two alternative sets of arguments can be included in this function to compute the scan test:</p><ul><li><p><code>Option 1</code>: A factor (fx) and coordinates (coor).</p></li>
<li><p><code>Option 2</code>: A sf object (data) and the formula to specify the factor.
The function consider the coordinates of the centroids of the elements of th sf object.</p></li>
</ul><p>The spatial scan statistics are widely used in epidemiology, criminology or ecology.
Their purpose is to analyse the spatial distribution of points or geographical
regions by testing the hypothesis of spatial randomness distribution on the
basis of different distributions (e.g. Bernoulli, Poisson or Normal distributions).
The <code>scan.test</code> function obtain the scan statistic for two relevant distributions related
with categorical variables: the Bernoulli and Multinomial distribution.<br>
The spatial scan statistic is based on the likelihood ratio test statistic and
is formulated as follows:<br>
$$\Delta = { \max_{z \in Z,H_A} L(\theta|z) \over \max_{z \in Z,H_0} L(\theta|z)}$$
where Z represents the collection of scanning windows constructed on the study region,
\(H_A\) is an alternative hypothesis, \(H_0\) is a null hypothesis, and \(L(\theta|z)\)
is the likelihood function with parameter \(\theta\) given window Z<br>.
The null hypothesis says that there is no spatial clustering on the study region, and
the alternative hypothesis is that there is a certain area with high (or low) rates of
outcome variables. The null and alternative hypotheses and the likelihood function may
be expressed in different ways depending on the probability model under consideration.<br>
To test independence in a spatial process, under the null, the type of windows is
irrelevant but under the alternative the elliptic
windows can to identify with more precision the cluster.</p>
<p>For big data sets (N &gt;&gt;) the windows = "elliptic" can be so slowly</p>
<p><strong>Bernoulli version</strong><br><br>
When we have dichotomous outcome variables, such as cases and noncases of certain
diseases, the Bernoulli model is used. The null hypothesis is written as
$$H_0 : p = q  \ \ for \ \  all  \ \ Z$$
and the alternative hypothesis is <br>
$$H_A : p \neq q  \ \ for  \ \ some  \ \ Z$$
where p and q are the outcome probabilities (e.g., the probability of being a case)
inside and outside scanning window Z, respectively. Given window Z, the test statistic is:<br></p>
<p>where cz and nz are the numbers of cases and observations (cases and noncases) within z,
respectively, and C and N are the total numbers of cases and observations in the whole
study region, respectively.<br>
$$\Delta = $$
<strong>Multinomial version of the scan test</strong><br><br>
The multinomial version of the spatial scan statistic is useful to investigate clustering
when a discrete spatial variable can take one and only one of k possible outcomes
that lack intrinsic order information. If the region defined by the moving window
is denoted by Z, the null hypothesis for the statistic can be stated as follows:<br>
$$H_0: p_1 = q_1;p_2 = q_2;...;p_k = q_k$$
where \(p_j\) is the probability of being of event type j inside the window Z,
and \(q_j\) is the probability of being of event type j outside the window.
The alternative hypothesis is that for at least one type event the probability
of being of that type is different inside and outside of the window.<br></p>
<p>The statistic is built as a likelihood ratio, and takes the following
form after transformation using the natural logarithm:
$$\Delta = \max_Z \{\sum_j \{ S_j^Z log({ S_j^Z \over S^Z }) +
(S_j-S_j^Z) log({ {S_j-S_j^Z} \over {S-S^Z} })\}\}-\sum_j S_j log({ S_j \over S }) $$
where S is the total number of events in the study area and \(S_j\) is the total number
of events of type j. The superscript Z denotes the same but for the sub-region
defined by the moving window. <br>
The theoretical distribution of the statistic under the null hypothesis is not known,
and therefore significance is evaluated numerically by simulating neutral landscapes
(obtained using a random spatial process) and contrasting the empirically calculated
statistic against the frequency of values obtained from the neutral landscapes.
The results of the likelihood ratio serve to identify the most likely cluster,
which is followed by secondary clusters by the expedient of sorting them according to
the magnitude of the test. As usual, significance is assigned by the analyst, and the
cutoff value for significance reflects the confidence of the analyst, or tolerance for error.<br>
When implementing the statistic, the analyst must decide the shape of the
window and the maximum number of cases that any given window can cover.
Currently, analysis can be done using circular or elliptical windows.<br>
Elliptical windows are more time consuming to evaluate but provide greater
flexibility to contrast the distribution of events inside and outside the window,
and are our selected shape in the analyses to follow. Furthermore, it is recommended
that the maximum number of cases entering any given window does not exceed 50\<!-- % of -->
all available cases.</p>
    </div>
    <div class="section level2">
    <h2 id="control-arguments">Control arguments<a class="anchor" aria-label="anchor" href="#control-arguments"></a></h2>


<table class="table table"><tr><td><code>seedinit</code></td><td>Numerical value for the seed (only for boot version). Default value seedinit=123</td></tr></table></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Kulldorff M, Nagarwalla N. (1995).
Spatial disease clusters: Detection and Inference.
<em>Statistics in Medicine</em>. 14:799-810</p></li>
<li><p>Jung I, Kulldorff M, Richard OJ (2010).
A spatial scan statistic for multinomial data.
<em>Statistics in Medicine</em>. 29(18), 1910-1918</p></li>
<li><p>Páez, A., López-Hernández, F.A., Ortega-García, J.A., Ruiz, M. (2016).
Clustering and co-occurrence of cancer types: A comparison of techniques with
an application to pediatric cancer in Murcia, Spain.
<em>Spatial Analysis in Health Geography</em>, 69-90.</p></li>
<li><p>Tango T., Takahashi K. (2005). A flexibly shaped spatial scan statistic
for detecting clusters, <em>International Journal of Health Geographics</em> 4:11.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="local.sp.runs.test.html">local.sp.runs.test</a></code>, <code><a href="dgp.spq.html">dgp.spq</a></code>, <code><a href="Q.test.html">Q.test</a></code>,</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>

<table class="table table"><tr><td>Fernando López</td><td><a href="mailto:fernando.lopez@upct.es">fernando.lopez@upct.es</a></td></tr><tr><td>Román Mínguez</td><td><a href="mailto:roman.minguez@uclm.es">roman.minguez@uclm.es</a></td></tr><tr><td>Antonio Páez</td><td><a href="mailto:paezha@gmail.com">paezha@gmail.com</a></td></tr><tr><td>Manuel Ruiz</td><td><a href="mailto:manuel.ruiz@upct.es">manuel.ruiz@upct.es</a></td></tr></table></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 1: Scan test bernoulli</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"men"</span>,<span class="st">"woman"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Mal2Fml</span></span></span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">provinces_spain</span>, case<span class="op">=</span><span class="st">"men"</span>,</span></span>
<span class="r-in"><span>nsim <span class="op">=</span> <span class="fl">99</span>, distr <span class="op">=</span> <span class="st">"bernoulli"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: bernoulli</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  Mal2Fml</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 6.0359, p-value = 0.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: High</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in the MLC =   17.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected cases in the MLC =       11.84</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed cases in the MLC =       16.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Distribution....................: bernoulli</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Type of cluster (alternative)...: High</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of locations.............: 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cathegory case..................: men</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of observations....: 37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories............: men woman</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total per category..............: 37 13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category............: 0.74 0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Scan statistic: Most Likely Cluster</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in the MLC........: 17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: men woman</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.74 0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.94 0.06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)...: 6.0359</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value..............................: 0.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IDs of cluster detect:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included...:  37 34 20 11 40 28 6 14 10 18 35 36 22 31 13 15 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Cluster. Number 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in secondary cluster.:  23 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: men woman</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.74 0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.61 0.39</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)...: 5.4635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value..............................: 0.15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included................:  41 25 19 1 9 30 48 39 50 27 46 16 42 33 38 45 43 5 21 12 2 44 13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Cluster. Number 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in secondary cluster.:  2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: men woman</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.74 0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)...: 0.3047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value..............................: 0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included................:  3 44</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Cluster. Number 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in secondary cluster.:  2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: men woman</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.74 0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)...: 0.3047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value..............................: 0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included................:  7 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Cluster. Number 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in secondary cluster.:  2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: men woman</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.74 0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)...: 0.3047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value..............................: 0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included................:  17 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Cluster. Number 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in secondary cluster.:  2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: men woman</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.74 0.26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)...: 0.3047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value..............................: 0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included................:  24 49</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scan</span>, sf <span class="op">=</span> <span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="scan.test-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">## With maximum number of neighborhood</span></span></span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">provinces_spain</span>, case <span class="op">=</span> <span class="st">"woman"</span>,</span></span>
<span class="r-in"><span>nsim <span class="op">=</span> <span class="fl">99</span>, distr <span class="op">=</span> <span class="st">"bernoulli"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: bernoulli</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  Mal2Fml</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 5.6358, p-value = 0.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: High</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in the MLC =   11.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected cases in the MLC =        7.02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed cases in the MLC =        7.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scan</span>, sf <span class="op">=</span> <span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="scan.test-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With elliptic windows</span></span></span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">provinces_spain</span>, case <span class="op">=</span> <span class="st">"men"</span>, nv <span class="op">=</span> <span class="fl">25</span>,</span></span>
<span class="r-in"><span>nsim <span class="op">=</span> <span class="fl">99</span>, distr <span class="op">=</span> <span class="st">"bernoulli"</span>, windows <span class="op">=</span><span class="st">"elliptic"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: bernoulli</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  Mal2Fml</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 7.038, p-value &lt; 2.2e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: High</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in the MLC =   19.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected cases in the MLC =       62.16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed cases in the MLC =       18.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">provinces_spain</span>, case <span class="op">=</span> <span class="st">"men"</span>, nv <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>nsim <span class="op">=</span> <span class="fl">99</span>, distr <span class="op">=</span> <span class="st">"bernoulli"</span>, windows <span class="op">=</span><span class="st">"elliptic"</span>, alternative <span class="op">=</span> <span class="st">"Low"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: bernoulli</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  Mal2Fml</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 5.9143, p-value = 0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: Low</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in the MLC =    5.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected cases in the MLC =       51.06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed cases in the MLC =        1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scan</span>, sf <span class="op">=</span> <span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="scan.test-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 2: scan test multinomial</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Older</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Older</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">19</span>,<span class="fl">22.5</span>,<span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Older</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>,<span class="st">"middle"</span>,<span class="st">"high"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Older</span></span></span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">provinces_spain</span>, nsim <span class="op">=</span> <span class="fl">99</span>, distr <span class="op">=</span> <span class="st">"multinomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: multinomial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  Older</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 4.2473, p-value = 0.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               low middle high Sum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cases.expect 2.24   2.88 2.88   8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cases.observ 0.00   6.00 2.00   8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scan</span>, sf <span class="op">=</span> <span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="scan.test-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 3: scan test multinomial</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">FastFood.sf</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Type</span></span></span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">FastFood.sf</span>, nsim <span class="op">=</span> <span class="fl">99</span>,</span></span>
<span class="r-in"><span>distr <span class="op">=</span> <span class="st">"multinomial"</span>, windows<span class="op">=</span><span class="st">"elliptic"</span>, nv <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: multinomial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  Type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 15.506, p-value &lt; 2.2e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  H     P     S Sum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cases.expect 13.48 14.86 14.66  43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cases.observ 16.00  1.00 26.00  43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Distribution....................: multinomial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of locations.............: 877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of cases...........: 877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories...........: H P S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases per category........: 275 303 299</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent cases per category......: 0.31 0.35 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Scan statistic:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in the MLC.........: 43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories...........: H P S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed cases in the MLC......: 13.48 14.86 14.66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected cases in the MLC......: 16 1 26</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statistic (loglik ratio)....: 15.5058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value........................: 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IDs of cluster detect:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included.....:  68 849 152 499 630 763 827 765 617 600 607 48 58 588 743 843 74 122 750 115 645 61 226 796 876 699 610 597 596 721 751 53 186 659 778 63 106 229 585 738 612 131 208</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  16 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: H P S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.31 0.35 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.25 0.5 0.25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 11.5285</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  677 311 781 128 108 436 551 576 21 374 319 717 561 6 629 547</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: H P S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.31 0.35 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.14 0.29 0.57</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 7.0038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.96</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  158 709 335 801 749 545 856</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  17 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: H P S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.31 0.35 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.35 0.35 0.29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 6.8747</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  521 782 162 643 297 220 267 265 104 530 312 523 783 157 531 848 680</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  17 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: H P S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.31 0.35 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.47 0.29 0.24</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 6.7961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  190 837 555 711 646 216 17 390 742 563 307 4 353 197 254 192 66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: H P S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.31 0.35 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.4 0.2 0.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 6.5951</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  78 365 668 228 170 857 306 708 651 187</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scan</span>, sf <span class="op">=</span> <span class="va">FastFood.sf</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="scan.test-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 4: DGP two categories</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">150</span></span></span>
<span class="r-in"><span><span class="va">cx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">listw</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html" class="external-link">knearneigh</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cx</span>,<span class="va">cy</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu"><a href="dgp.spq.html">dgp.spq</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">p</span>, listw <span class="op">=</span> <span class="va">listw</span>, rho <span class="op">=</span> <span class="va">rho</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>fx <span class="op">=</span> <span class="va">fx</span>, nsim <span class="op">=</span> <span class="fl">99</span>, case <span class="op">=</span> <span class="st">"A"</span>, nv <span class="op">=</span> <span class="fl">50</span>, coor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cx</span>,<span class="va">cy</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>distr <span class="op">=</span> <span class="st">"bernoulli"</span>,windows<span class="op">=</span><span class="st">"circular"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: bernoulli</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  fx</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 11.523, p-value &lt; 2.2e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: High</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total observations in the MLC =   50.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected cases in the MLC =       24.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed cases in the MLC =       38.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="scan.test-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 5: DGP three categories</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span><span class="va">cx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">listw</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html" class="external-link">knearneigh</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cx</span>,<span class="va">cy</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span></span>
<span class="r-in"><span><span class="va">fx</span> <span class="op">&lt;-</span> <span class="fu"><a href="dgp.spq.html">dgp.spq</a></span><span class="op">(</span>p <span class="op">=</span> <span class="va">p</span>, listw <span class="op">=</span> <span class="va">listw</span>, rho <span class="op">=</span> <span class="va">rho</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>fx <span class="op">=</span> <span class="va">fx</span>, nsim <span class="op">=</span> <span class="fl">19</span>, coor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">cx</span>,<span class="va">cy</span><span class="op">)</span>, nv <span class="op">=</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>distr <span class="op">=</span> <span class="st">"multinomial"</span>, windows <span class="op">=</span> <span class="st">"elliptic"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: multinomial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  fx</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 11.282, p-value = 0.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  A    B    C Sum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cases.expect  7.04 6.93 7.04  21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cases.observ 17.00 2.00 2.00  21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="scan.test-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Case 6: Flexible windows</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>‘&gt;’ not meaningful for factors</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">provinces_spain</span><span class="op">$</span><span class="va">Mal2Fml</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"men"</span>,<span class="st">"woman"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">Mal2Fml</span></span></span>
<span class="r-in"><span><span class="va">listw</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">poly2nb</a></span><span class="op">(</span><span class="va">provinces_spain</span>, queen <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> although coordinates are longitude/latitude, st_intersects assumes that they</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> are planar</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>some observations have no neighbours;</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> if this seems unexpected, try increasing the snap argument.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 4 sub-graphs;</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> if this sub-graph count seems unexpected, try increasing the snap argument.</span>
<span class="r-in"><span><span class="va">scan</span> <span class="op">&lt;-</span> <span class="fu">scan.test</span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, data <span class="op">=</span> <span class="va">provinces_spain</span>, case<span class="op">=</span><span class="st">"men"</span>, listw <span class="op">=</span> <span class="va">listw</span>, nv <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>                  nsim <span class="op">=</span> <span class="fl">99</span>, distr <span class="op">=</span> <span class="st">"bernoulli"</span>, windows <span class="op">=</span> <span class="st">"flexible"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in scan.test(formula = formula, data = provinces_spain, case = "men",     listw = listw, nv = 6, nsim = 99, distr = "bernoulli", windows = "flexible"):</span> The factor mut be have 2 levels for bernoulli</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Scan test. Distribution: multinomial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  fx</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scan-loglik = 11.282, p-value = 0.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  A    B    C Sum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cases.expect  7.04 6.93 7.04  21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cases.observ 17.00 2.00 2.00  21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">scan</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Distribution....................: multinomial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of locations.............: 200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total number of cases...........: 200</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories...........: A B C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases per category........: 67 66 67</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent cases per category......: 0.34 0.33 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Scan statistic:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in the MLC.........: 21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories...........: A B C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observed cases in the MLC......: 7.04 6.93 7.04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Expected cases in the MLC......: 17 2 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statistic (loglik ratio)....: 11.2825</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value........................: 0.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IDs of cluster detect:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included.....:  143 107 116 74 109 135 14 175 97 18 16 6 152 67 78 44 30 163 136 9 92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: A B C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.34 0.33 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.29 0.43 0.29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 6.7479</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  77 70 157 27 76 29 46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: A B C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.34 0.33 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.22 0.22 0.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 6.0705</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  144 15 91 186 3 118 159 20 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  14 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: A B C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.34 0.33 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.29 0.36 0.36</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 5.4689</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  104 147 179 161 126 139 102 150 49 156 172 111 60 131</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  21 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: A B C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.34 0.33 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.14 0.52 0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 5.2965</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  38 87 24 120 128 42 101 93 48 17 45 99 188 148 73 54 184 134 200 138 196</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Secondary Scan statistic. Number 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total cases in secondary cluster......:  9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Names of cathegories.................: A B C</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category total...........: 0.34 0.33 0.34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percent per category inside cluster..: 0.22 0.56 0.22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of statisitic (loglik ratio)....: 4.4899</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value.........................: 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Location IDs included..................:  85 22 158 181 170 55 194 4 75</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">scan</span>, sf <span class="op">=</span> <span class="va">provinces_spain</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="scan.test-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Fernando Lopez, Roman Minguez, Antonio Paez, Manuel Ruiz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

